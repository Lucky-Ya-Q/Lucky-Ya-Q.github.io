---
title: 提供接口给第三方系统
date: 2022-09-13 09:45:12
permalink: /pages/968dbd/
article: false
---

通用参考：[鉴权认证机制 | 百度AI开放平台](https://ai.baidu.com/ai-doc/REFERENCE/Ck3dwjhhu)

在线文档：[OAuth2-Server搭建](https://sa-token.dev33.cn/doc/index.html#/oauth2/oauth2-server)

## 开启客户端模式

```yml
# Sa-Token 配置
sa-token:
  token-name: satoken-server
  # OAuth2.0 配置
  oauth2:
    # 是否打开模式：授权码
    is-code: false
    # 是否打开模式：凭证式
    is-client: true
```

## 放行资源交给SaToken处理

```java
@Override
public void configure(WebSecurity web) throws Exception {
    web.ignoring()
            .antMatchers("/oauth2/**", "/rest2/**");
}
```

```java {7-11}
/**
 * 自定义拦截规则
 */
@Override
public void addInterceptors(InterceptorRegistry registry) {
    registry.addInterceptor(repeatSubmitInterceptor).addPathPatterns("/**");
    // 注册 Sa-Token 拦截器，打开注解式鉴权功能
    registry.addInterceptor(new SaInterceptor(handle -> {
        String access_token = SpringMVCUtil.getRequest().getParameter("access_token");
        SaOAuth2Util.checkClientToken(access_token);
    })).addPathPatterns("/rest2/**");
}
```

## 提供测试接口

```java
@RestController
@RequestMapping("/rest2/test")
public class Rest2TestController {
    @GetMapping("/hello")
    public AjaxResult hello() {
        return AjaxResult.success();
    }
}
```

## 测试功能

获取 Access Token：http://127.0.0.1:8080/oauth2/client_token?grant_type=client_credentials&client_id=1001&client_secret=aaaa-bbbb-cccc-dddd-eeee

访问资源：http://127.0.0.1:8080/rest2/test/hello?access_token=blVac7tBBPPvZFOVlSAsuDyw8rgBx9ljvRlqfh9oQMoPfNCZPu4IlwZ0DBmw
