---
title: 第4章 响应系统的作用与实现
date: 2022-07-05 10:42:13
permalink: /pages/ee51fb/
categories: 
  - 《Vue.js设计与实现》
  - 第二篇 响应系统
tags: 
  - null
article: false
---

## 4.1 响应式数据与副作用函数

```js
const obj = {text: 'hello world'}

function effect() {
    document.body.innerText = obj.text
}

effect()

setTimeout(() => {
    obj.text = 'hello vue3'
}, 1000)
```

我们希望当 obj.text 的值变化后，副作用函数 effect 自动重新执行

## 4.2 响应式数据的基本实现

当读取字段 obj.text 时，我们可以把正在执行的副作用函数存储到一个“桶”里

当设置 obj.text 时，再把副作用函数从“桶”里取出并执行即可

```js
const bucket = new Set()

const data = {text: 'hello world'}

const obj = new Proxy(data, {
    get(target, key) {
        if (activeEffect) {
            bucket.add(activeEffect)
        }
        return target[key]
    },
    set(target, key, newVal) {
        target[key] = newVal
        bucket.forEach(fn => fn())
        return true
    }
})

let activeEffect

function effect(fn) {
    activeEffect = fn
    fn()
}

effect(() => {
    document.body.innerText = obj.text
})

setTimeout(() => {
    obj.text = 'hello vue3'
}, 1000)
```

## 4.3 设计一个完善的响应系统

## 4.4 分支切换与 cleanup

## 4.5 嵌套的 effect 与 effect 栈

## 4.6 避免无限递归循环

## 4.7 调度执行

## 4.8 计算属性 computed 与 lazy

## 4.9 watch 的实现原理

## 4.10 立即执行的 watch 与回调执行时机

## 4.11 过期的副作用
